<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Consulta de Datos - Tecnologías Chapinas</title>
    <style>
        /* ... (los estilos se quedan exactamente igual) ... */
        body { font-family: system-ui, sans-serif; margin: 2rem; background-color: #f7f7f7; color: #333; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1, h2 { color: #1a237e; border-bottom: 2px solid #ddd; padding-bottom: 0.5rem; }
        table { width: 100%; border-collapse: collapse; margin-top: 1.5rem; }
        th, td { padding: 0.8rem; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #f2f2f2; }
        .nav-link { display: inline-block; margin-bottom: 1rem; padding: 0.7rem 1.5rem; background-color: #1a237e; color: white; text-decoration: none; border-radius: 5px; }
        .nav-link:hover { background-color: #3949ab; }
        .error { color: #b71c1c; background-color: #ffebee; padding: 1rem; border: 1px solid #f44336; border-radius: 5px; }
        .empty { color: #555; background-color: #f5f5f5; padding: 1rem; border: 1px solid #ddd; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <a href="{% url 'simulador_app:inicio' %}" class="nav-link">← Volver a Cargar Archivos</a>
        <h1>Consulta de Datos del Sistema</h1>
        <h2>Generar Reporte de Análisis de Ventas</h2>
        <form method="POST" action="{% url 'simulador_app:generar_reporte_ventas' %}">
            {% csrf_token %}
            <label for="fecha_inicio">Fecha de Inicio:</label>
            <input type="date" id="fecha_inicio" name="fecha_inicio" required>
            <label for="fecha_fin">Fecha de Fin:</label>
            <input type="date" id="fecha_fin" name="fecha_fin" required>
            <button type="submit">Descargar Reporte en PDF</button>
        </form>

        {% if error %}
            <p class="error">{{ error }}</p>
        {% else %}
            {% with datos_config=datos.archivoConfiguraciones %}
                <!-- Sección de Recursos -->
                <h2>Recursos Disponibles</h2>
                {% with recursos=datos_config.listaRecursos.recurso %}
                    {% if recursos %}
                        <table>
                            <thead><tr><th>ID</th><th>Nombre</th><th>Abreviatura</th><th>Métrica</th><th>Tipo</th><th>Valor por Hora</th></tr></thead>
                            <tbody>
                                {% for recurso in recursos %}
                                    <tr>
                                        <!-- CAMBIO: Ya no usamos '@id', ahora es solo 'id' -->
                                        <td>{{ recurso.id }}</td>
                                        <td>{{ recurso.nombre }}</td>
                                        <td>{{ recurso.abreviatura }}</td>
                                        <td>{{ recurso.metrica }}</td>
                                        <td>{{ recurso.tipo }}</td>
                                        <td>{{ recurso.valorXhora }}</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <p class="empty">No hay recursos cargados.</p>
                    {% endif %}
                {% endwith %}

                <!-- Sección de Clientes -->
                <h2>Clientes Registrados</h2>
                {% with clientes=datos_config.listaClientes.cliente %}
                    {% if clientes %}
                        {% for cliente in clientes %}
                            <!-- CAMBIO: Ya no usamos '@nit', ahora es solo 'nit' -->
                            <h3>Cliente: {{ cliente.nombre }} (NIT: {{ cliente.nit }})</h3>
                            <h4>Instancias:</h4>
                            {% with instancias=cliente.listaInstancias.instancia %}
                                {% if instancias %}
                                    <table>
                                        <thead><tr><th>ID</th><th>Nombre</th><th>ID Config.</th><th>Estado</th><th>Fecha Inicio</th><th>Fecha Final</th></tr></thead>
                                        <tbody>
                                        {% for instancia in instancias %}
                                            <tr>
                                                <!-- CAMBIO: Ya no usamos '@id', ahora es solo 'id' -->
                                                <td>{{ instancia.id }}</td>
                                                <td>{{ instancia.nombre }}</td>
                                                <td>{{ instancia.idConfiguracion }}</td>
                                                <td>{{ instancia.estado }}</td>
                                                <td>{{ instancia.fechaInicio }}</td>
                                                <td>{{ instancia.fechaFinal }}</td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                {% else %}
                                    <p class="empty">Este cliente no tiene instancias.</p>
                                {% endif %}
                            {% endwith %}
                        {% endfor %}
                    {% else %}
                        <p class="empty">No hay clientes cargados.</p>
                    {% endif %}
                {% endwith %}
            {% endwith %}
        {% endif %}
    </div>
</body>
</html>